@isTest
private class TestUpsertUsers {

    public static String CRON_EXP = '0 0 0 28 2 ? 2022';

    static testmethod void testScheduledJob() {

        //menos un customer
        //json = '[{\n  \"Accounts\": [\n    {\n      \"AccountNumber\": \"ac2ac724-5eee-482f-8aeb-55c1ec23d71d\",\n      \"AccountName\": \"Jabbertype\",\n      \"AccountStatus\": \"Inactive\",\n      \"AsOfDate\": \"9/27/2016\",\n      \"Customers\": [\n        {\n          \"FirstName\": \"Nonnah\",\n          \"LastName\": \"Drayton\",\n          \"Email\": \"no\'neill0@diigo.com\",\n          \"Phone\": \"375-(586)345-1801\",\n          \"Address\": \"7956 Luster Terrace\",\n          \"CustomerNumber\": \"0fc81d74-cad8-49e0-9567-9e8d0a612a7a\"\n        },\n        {\n          \"FirstName\": \"Foster\",\n          \"LastName\": \"Tackes\",\n          \"Email\": \"fmeneo1@quantcast.com\",\n          \"Phone\": \"30-(400)275-3547\",\n          \"Address\": \"12074 Lakewood Gardens Alley\",\n          \"CustomerNumber\": \"5cd44ecd-e310-4277-9328-4023b8fc6987\"\n        },\n        {\n          \"FirstName\": \"Nicoli\",\n          \"LastName\": \"Furmagier\",\n          \"Email\": \"ncauson2@themeforest.net\",\n          \"Phone\": \"970-(336)587-8052\",\n          \"Address\": \"2 Huxley Point\",\n          \"CustomerNumber\": \"9da711a3-2e87-48de-8774-0296526541d2\"\n        },\n        {\n          \"FirstName\": \"Filberte\",\n          \"LastName\": \"Teasdale-Markie\",\n          \"Email\": \"fgowdy3@hibu.com\",\n          \"Phone\": \"380-(747)331-9641\",\n          \"Address\": \"2 Bluejay Crossing\",\n          \"CustomerNumber\": \"5b1c778a-c7c0-4bbd-9a36-43d79283330d\"\n        }\n      ]\n    },\n    {\n      \"AccountNumber\": \"a8c090d6-165e-424a-8e57-7fb57f69313c\",\n      \"AccountName\": \"Wikizz\",\n      \"AccountStatus\": \"Active\",\n      \"AsOfDate\": \"10/3/2016\",\n      \"Customers\": [\n        {\n          \"FirstName\": \"Nonnah\",\n          \"LastName\": \"Swindells\",\n          \"Email\": \"ngrinyakin0@spiegel.de\",\n          \"Phone\": \"86-(178)738-2183\",\n          \"Address\": \"4 Algoma Drive\",\n          \"CustomerNumber\": \"128bf918-0d4a-4755-9e38-ab065ae3a9b4\"\n        },\n        {\n          \"FirstName\": \"Jessika\",\n          \"LastName\": \"Antonescu\",\n          \"Email\": \"jwadlow1@mail.ru\",\n          \"Phone\": \"351-(785)244-5709\",\n          \"Address\": \"00 Maywood Parkway\",\n          \"CustomerNumber\": \"d0269c28-42d6-4a1f-a605-fb22a6c598d5\"\n        },\n        {\n          \"FirstName\": \"Odey\",\n          \"LastName\": \"McElvogue\",\n          \"Email\": \"obirchall2@dedecms.com\",\n          \"Phone\": \"963-(970)720-2612\",\n          \"Address\": \"23719 Petterle Place\",\n          \"CustomerNumber\": \"99a12bc8-c162-4c75-afb1-022ebb1165c7\"\n        },\n        {\n          \"FirstName\": \"Lee\",\n          \"LastName\": \"Casillas\",\n          \"Email\": \"lcoase3@cnbc.com\",\n          \"Phone\": \"358-(576)398-2215\",\n          \"Address\": \"28592 Blue Bill Park Center\",\n          \"CustomerNumber\": \"d22cf9ac-b565-4687-8462-d14445bbbb1a\"\n        }\n      ]\n    },\n    {\n      \"AccountNumber\": \"b8b17453-fefd-4755-a494-f810def3cd36\",\n      \"AccountName\": \"Yadel\",\n      \"AccountStatus\": \"Inactive\",\n      \"AsOfDate\": \"9/17/2016\",\n      \"Customers\": [\n        {\n          \"FirstName\": \"Sansone\",\n          \"LastName\": \"Ducker\",\n          \"Email\": \"sbirds0@tripadvisor.com\",\n          \"Phone\": \"86-(771)935-2121\",\n          \"Address\": \"72 Killdeer Street\",\n          \"CustomerNumber\": \"8e09e740-32b4-4c7e-9fa7-ff463dab8d91\"\n        },\n        {\n          \"FirstName\": \"Jeralee\",\n          \"LastName\": \"McGirr\",\n          \"Email\": \"jjerschke1@ow.ly\",\n          \"Phone\": \"46-(560)441-1059\",\n          \"Address\": \"24153 Weeping Birch Way\",\n          \"CustomerNumber\": \"3122a79f-0e8c-4f2e-be85-9ce618f5b8de\"\n        },\n        {\n          \"FirstName\": \"Esme\",\n          \"LastName\": \"Fibbens\",\n          \"Email\": \"edelacourt2@ucoz.ru\",\n          \"Phone\": \"60-(549)189-1306\",\n          \"Address\": \"897 Surrey Junction\",\n          \"CustomerNumber\": \"d7196130-50b7-4ed7-96c9-b729e43ebb5e\"\n        }\n      ]\n    }\n  ]\n}]';
        //menos un financial advisor
       // json = '[{\n  \"Accounts\": [\n     {\n      \"AccountNumber\": \"a8c090d6-165e-424a-8e57-7fb57f69313c\",\n      \"AccountName\": \"Wikizz\",\n      \"AccountStatus\": \"Active\",\n      \"AsOfDate\": \"10/3/2016\",\n      \"Customers\": [\n        {\n          \"FirstName\": \"Nonnah\",\n          \"LastName\": \"Swindells\",\n          \"Email\": \"ngrinyakin0@spiegel.de\",\n          \"Phone\": \"86-(178)738-2183\",\n          \"Address\": \"4 Algoma Drive\",\n          \"CustomerNumber\": \"128bf918-0d4a-4755-9e38-ab065ae3a9b4\"\n        },\n        {\n          \"FirstName\": \"Jessika\",\n          \"LastName\": \"Antonescu\",\n          \"Email\": \"jwadlow1@mail.ru\",\n          \"Phone\": \"351-(785)244-5709\",\n          \"Address\": \"00 Maywood Parkway\",\n          \"CustomerNumber\": \"d0269c28-42d6-4a1f-a605-fb22a6c598d5\"\n        },\n        {\n          \"FirstName\": \"Odey\",\n          \"LastName\": \"McElvogue\",\n          \"Email\": \"obirchall2@dedecms.com\",\n          \"Phone\": \"963-(970)720-2612\",\n          \"Address\": \"23719 Petterle Place\",\n          \"CustomerNumber\": \"99a12bc8-c162-4c75-afb1-022ebb1165c7\"\n        },\n        {\n          \"FirstName\": \"Lee\",\n          \"LastName\": \"Casillas\",\n          \"Email\": \"lcoase3@cnbc.com\",\n          \"Phone\": \"358-(576)398-2215\",\n          \"Address\": \"28592 Blue Bill Park Center\",\n          \"CustomerNumber\": \"d22cf9ac-b565-4687-8462-d14445bbbb1a\"\n        }\n      ]\n    },\n    {\n      \"AccountNumber\": \"b8b17453-fefd-4755-a494-f810def3cd36\",\n      \"AccountName\": \"Yadel\",\n      \"AccountStatus\": \"Inactive\",\n      \"AsOfDate\": \"9/17/2016\",\n      \"Customers\": [\n        {\n          \"FirstName\": \"Jeralee\",\n          \"LastName\": \"McGirr\",\n          \"Email\": \"jjerschke1@ow.ly\",\n          \"Phone\": \"46-(560)441-1059\",\n          \"Address\": \"24153 Weeping Birch Way\",\n          \"CustomerNumber\": \"3122a79f-0e8c-4f2e-be85-9ce618f5b8de\"\n        },\n        {\n          \"FirstName\": \"Esme\",\n          \"LastName\": \"Fibbens\",\n          \"Email\": \"edelacourt2@ucoz.ru\",\n          \"Phone\": \"60-(549)189-1306\",\n          \"Address\": \"897 Surrey Junction\",\n          \"CustomerNumber\": \"d7196130-50b7-4ed7-96c9-b729e43ebb5e\"\n        }\n      ]\n    }\n  ]\n}]\n';


        

        //insert custom setting
        S3_Bucket__c setting = new S3_Bucket__c();
        setting.Name = 'training';
        setting.Key__c = 'xxx';
        setting.Secret__c = 'xxxx';
        insert setting;

        Test.startTest();
         String jobId = System.schedule('testScheduledJob', CRON_EXP, new upsertUsers()); 
        Test.stopTest();


        List<Financial_Advisor__c> fas = [SELECT Id FROM Financial_Advisor__c];
        System.assertEquals(200, fas.size());
            
    }
}